# GitHub Automation for DuckDuckGo Bangs

This document explains how the automated system works to keep the DuckDuckGo bang list up-to-date.

## Overview

The project automatically fetches the latest DuckDuckGo bangs every month and updates the `src/bang.ts` file. This ensures that users always have access to the most current search shortcuts.

## How It Works

### 1. Scheduled Execution
- **Frequency**: Every month on the 1st at 2 AM UTC
- **Trigger**: GitHub Actions cron schedule
- **File**: `.github/workflows/update-ddg-bangs.yml`

### 2. Data Source
- **API Endpoint**: `https://duckduckgo.com/bang.js`
- **Format**: JSON array of bang objects
- **Example Response**:
```json
[
  {
    "c": "Tech",
    "d": "www.youtube.com",
    "r": 0,
    "s": "YouTube",
    "sc": "Video sharing platform",
    "t": "yt",
    "u": "https://www.youtube.com/results?search_query={{{s}}}"
  }
]
```

### 3. Data Transformation
The script converts DuckDuckGo's format to our TypeScript format:

**Input (DuckDuckGo)**:
```json
{
  "t": "yt",
  "s": "YouTube", 
  "u": "https://www.youtube.com/results?search_query={{{s}}}",
  "d": "www.youtube.com"
}
```

**Output (Our Format)**:
```typescript
{
  t: "yt",
  s: "YouTube",
  u: "https://www.youtube.com/results?search_query={{{s}}}",
  d: "www.youtube.com"
}
```

### 4. File Generation
The script generates a complete TypeScript file:
```typescript
// This file is auto-generated by scripts-for-workflow/update-ddg-bangs.js
// Do not edit manually - changes will be overwritten
// Last updated: 2025-01-27T10:30:00.000Z

export const bangs = [
  // ... all bangs here
];
```

## Workflow Steps

### 1. Setup
- Checkout repository
- Setup Node.js 18+

### 2. Validation
- Validate current bang list structure
- Ensure file integrity before updates

### 3. Update
- Fetch latest data from DuckDuckGo
- Convert format
- Generate new TypeScript file

### 4. Post-Update Validation
- Validate updated file structure
- Check for errors or corruption

### 5. Commit & Push
- Only if changes are detected
- Automatic commit with descriptive message
- Skip CI to prevent infinite loops

### 6. Build Verification
- Run build process
- Ensure everything compiles correctly

## Scripts

### Main Update Script
- **File**: `scripts-for-workflow/update-ddg-bangs.js`
- **Purpose**: Fetch, convert, and write bang data
- **Features**:
  - Error handling and validation
  - Timeout protection (30s)
  - Data filtering for required fields
  - Proper escaping of special characters

### Validation Script
- **File**: `scripts-for-workflow/validate-bangs.js`
- **Purpose**: Verify file structure and content
- **Checks**:
  - File exists and is readable
  - Contains proper TypeScript syntax
  - Has expected number of entries
  - Each entry has required fields

### API Test Script
- **File**: `scripts-for-workflow/test-api.js`
- **Purpose**: Test DuckDuckGo API connectivity
- **Features**:
  - Quick API response test
  - Response format validation
  - Network timeout handling

## Manual Execution

### Trigger via GitHub
1. Go to Actions tab
2. Select "Update Bang List" workflow
3. Click "Run workflow"

### Local Execution
```bash
# Test API connectivity
npm run test-api

# Update bangs locally
npm run update-bangs

# Validate current file
npm run validate-bangs

# Run all tests
npm test
```

## Error Handling

### Network Issues
- 30-second timeout for API requests
- Retry logic for failed requests
- Detailed error logging

### Data Validation
- Checks for required fields (t, s, u, d)
- Validates JSON structure
- Ensures minimum bang count

### File Operations
- Creates directories if needed
- Validates file writes
- Checks file integrity after updates

## Monitoring

### Success Indicators
- ✅ API test successful
- ✅ Bang list updated with X entries
- ✅ File validation passed
- ✅ Changes committed and pushed

### Failure Indicators
- ❌ HTTP request failed
- ❌ Failed to parse JSON
- ❌ Validation failed
- ❌ No valid bangs found

## Troubleshooting

### Common Issues

1. **API Unavailable**
   - Check DuckDuckGo status
   - Verify network connectivity
   - Check API endpoint changes

2. **Validation Failures**
   - Run `npm run validate-bangs`
   - Check file structure
   - Verify TypeScript syntax

3. **No Changes Detected**
   - API might return same data
   - Check if file was actually modified
   - Verify git status

### Debug Commands
```bash
# Test API directly
curl https://duckduckgo.com/bang.js | head -c 500

# Check file structure
grep -c "t: " src/bang.ts

# Validate TypeScript
npx tsc --noEmit src/bang.ts
```

## Security Considerations

- Uses `GITHUB_TOKEN` for authentication
- No external secrets required
- Read-only access to DuckDuckGo API
- Automatic commit signing with GitHub Actions

## Performance

- **Typical Execution Time**: 2-5 minutes
- **File Size**: ~2-3 MB (80,000+ bangs)
- **Memory Usage**: Minimal (streaming processing)
- **Network**: Single HTTPS request to DuckDuckGo

## Future Enhancements

- [ ] Add retry logic for failed API calls
- [ ] Implement incremental updates
- [ ] Add metrics and monitoring
- [ ] Support for multiple bang sources
- [ ] Automated testing of generated bangs
